<!DOCTYPE html>
<html>
  <head>
    <title>Send GPS Coordinfate</title>
  </head>
  <body>
    <label for="serverUrl">IP server address:</label>
    <input type="text" id="serverUrl" />
    <br />
    <br />
    <br />
    <button id="startStopButton">START</button>
    <br />
    <br />
    <br />
    <label id="connection">Connection status:</label>
    <script>
      let intervalId;
      let currentPosition;
      let serverUrlInput = document.getElementById('serverUrl');
      let startStopButton = document.getElementById('startStopButton');
      var interlId = null;

      startStopButton.addEventListener('click', function() {
      
        if (startStopButton.innerText === 'START') {
          startStopButton.innerText = 'STOP';
      
          intervalId = setInterval(function() {
            if (navigator.geolocation) {
              navigator.geolocation.getCurrentPosition(
                function(position) {
                  currentPosition = position;
                  
                  let lat = currentPosition.coords.latitude;
                  let lon = currentPosition.coords.longitude;
                  let data = { lat: lat, lon: lon };
                  let url = "http://" + serverUrlInput.value;
                  fetch(url, {
                    method: 'POST',
                    headers: {
                      'Content-Type': 'application/json',
                      'accept': 'application/json'
                    },
                    body: JSON.stringify(data)
                  })
                  .then(response => response.json())
                  .then(data => {
                    if(data['status'] == 0){
                      document.getElementById('connection').innerText = "Connection status: ok";
                      document.getElementById('connection').style.color = "forestgreen"
                    }
                    else{
                      document.getElementById('connection').innerText = "Connection status: failed";
                      document.getElementById('connection').style.color = "red";
                    }
                  })
                  .catch(error => {
                    document.getElementById('connection').innerText = "Connection status: failed";
                    document.getElementById('connection').style.color = "red";
                  });
                }
              );
            }
            else {
              console.log('Geolocation is not supported by this browser.');
            }
          }, 1000);
        } 
        else {
          startStopButton.innerText = 'START';
          clearInterval(intervalId);
        }
      });
    </script>
  </body>
</html>